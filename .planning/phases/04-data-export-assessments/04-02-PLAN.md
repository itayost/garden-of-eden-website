---
phase: 04-data-export-assessments
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - src/components/admin/assessments/DeleteAssessmentDialog.tsx
  - src/app/admin/assessments/[userId]/page.tsx
autonomous: true

must_haves:
  truths:
    - "Admin sees delete button on each assessment card"
    - "Clicking delete shows confirmation dialog"
    - "Confirming deletion calls softDeleteAssessmentAction"
    - "Assessment disappears after deletion"
    - "Toast notification confirms success"
  artifacts:
    - path: "src/components/admin/assessments/DeleteAssessmentDialog.tsx"
      provides: "Delete confirmation dialog for assessments"
      min_lines: 50
    - path: "src/app/admin/assessments/[userId]/page.tsx"
      provides: "Assessment page with delete buttons"
      contains: "DeleteAssessmentDialog"
  key_links:
    - from: "src/components/admin/assessments/DeleteAssessmentDialog.tsx"
      to: "softDeleteAssessmentAction"
      via: "import and call"
      pattern: "softDeleteAssessmentAction"
---

<objective>
Add delete button to assessment cards with confirmation dialog.

Purpose: Allow admins to soft-delete assessments from the UI with proper confirmation.
Output: DeleteAssessmentDialog component and updated assessment page.
</objective>

<execution_context>
@/Users/itayostraich/.claude/get-shit-done/workflows/execute-plan.md
@/Users/itayostraich/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/04-data-export-assessments/04-CONTEXT.md

# Reference patterns:
@src/components/admin/users/DeleteUserDialog.tsx (exact pattern to follow)
@src/app/admin/assessments/[userId]/page.tsx (page to modify)
@.planning/phases/04-data-export-assessments/04-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DeleteAssessmentDialog component</name>
  <files>src/components/admin/assessments/DeleteAssessmentDialog.tsx</files>
  <action>
Create DeleteAssessmentDialog following DeleteUserDialog.tsx pattern EXACTLY:

Props:
- assessmentId: string
- assessmentDate: string (for display in confirmation message)
- trigger?: React.ReactNode (optional custom trigger button)

Component structure:
1. "use client" directive
2. Import: useState, useRouter from next/navigation
3. Import: AlertDialog components from @/components/ui/alert-dialog
4. Import: Button from @/components/ui/button
5. Import: toast from sonner
6. Import: Loader2, Trash2 from lucide-react
7. Import: softDeleteAssessmentAction from @/lib/actions/admin-assessments

State: open (boolean), loading (boolean)

handleDelete function:
- setLoading(true)
- try/catch calling softDeleteAssessmentAction(assessmentId)
- Check result with `if (!("success" in result))` pattern
- On error: toast.error(result.error)
- On success: toast.success("המבדק נמחק בהצלחה"), setOpen(false), router.refresh()
- finally: setLoading(false)

Dialog content (Hebrew):
- Title: "מחיקת מבדק"
- Description: "האם אתה בטוח שברצונך למחוק את המבדק מתאריך {formatted date}?"
- Sub-description: "המבדק יסומן כמחוק אך הנתונים ישמרו במערכת."
- Cancel button: "ביטול"
- Confirm button: "מחק מבדק" (red/destructive styling)
- Loading state: show Loader2 spinner + "מוחק..."

Format the date using: `new Date(assessmentDate).toLocaleDateString("he-IL")`

Use the same styling patterns as DeleteUserDialog (destructive button styling).

Default trigger: ghost variant button with Trash2 icon only (no text).
  </action>
  <verify>TypeScript compiles: `npm run build -- --no-emit 2>&1 | head -20`</verify>
  <done>DeleteAssessmentDialog component created with all dialog elements.</done>
</task>

<task type="auto">
  <name>Task 2: Add delete button to assessment cards</name>
  <files>src/app/admin/assessments/[userId]/page.tsx</files>
  <action>
Modify the assessment page to add delete buttons:

1. Import DeleteAssessmentDialog at the top:
   `import { DeleteAssessmentDialog } from "@/components/admin/assessments/DeleteAssessmentDialog";`

2. Add delete button to each assessment card's CardHeader:

Find the CardHeader section that shows the date and completeness badge.
Add DeleteAssessmentDialog inside the flex container that has `justify-between`.

Current structure:
```tsx
<CardHeader>
  <div className="flex items-center justify-between">
    <div className="flex items-center gap-2">
      <Calendar className="h-4 w-4 text-muted-foreground" />
      <CardTitle className="text-base">...</CardTitle>
    </div>
    <Badge ...>completeness</Badge>
  </div>
</CardHeader>
```

Change to wrap Badge and DeleteAssessmentDialog together:
```tsx
<CardHeader>
  <div className="flex items-center justify-between">
    <div className="flex items-center gap-2">
      <Calendar className="h-4 w-4 text-muted-foreground" />
      <CardTitle className="text-base">...</CardTitle>
    </div>
    <div className="flex items-center gap-2">
      <Badge ...>completeness</Badge>
      <DeleteAssessmentDialog
        assessmentId={a.id}
        assessmentDate={a.assessment_date}
      />
    </div>
  </div>
</CardHeader>
```

3. Ensure the query filters out deleted assessments:

Add `.is("deleted_at", null)` to the assessments query if not already present:
```tsx
supabase
  .from("player_assessments")
  .select("*")
  .eq("user_id", userId)
  .is("deleted_at", null)  // Add this filter
  .order("assessment_date", { ascending: false })
```
  </action>
  <verify>TypeScript compiles: `npm run build -- --no-emit 2>&1 | head -20`</verify>
  <done>Delete button visible on each assessment card, deleted assessments filtered out.</done>
</task>

</tasks>

<verification>
1. DeleteAssessmentDialog component exists
2. Assessment page imports and uses DeleteAssessmentDialog
3. Deleted assessments are filtered from view
4. TypeScript compiles without errors
</verification>

<success_criteria>
- Delete button (trash icon) appears on each assessment card
- Clicking shows confirmation dialog with Hebrew text
- Confirming calls server action and refreshes page
- Deleted assessments no longer appear in list
</success_criteria>

<output>
After completion, create `.planning/phases/04-data-export-assessments/04-02-SUMMARY.md`
</output>
