---
phase: 02-user-management
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/app/admin/users/create/page.tsx
  - src/components/admin/users/UserCreateForm.tsx
autonomous: true

must_haves:
  truths:
    - "Admin can access user creation page at /admin/users/create"
    - "Form collects Name, Phone, Role (Email optional)"
    - "Form submission calls createUserAction server action"
    - "Success shows toast and redirects to /admin/users"
    - "Validation errors display inline under fields"
  artifacts:
    - path: "src/app/admin/users/create/page.tsx"
      provides: "User creation page for admins"
      min_lines: 30
    - path: "src/components/admin/users/UserCreateForm.tsx"
      provides: "Form component for creating new users"
      exports: ["UserCreateForm"]
  key_links:
    - from: "src/components/admin/users/UserCreateForm.tsx"
      to: "src/lib/actions/admin-users.ts"
      via: "createUserAction import"
      pattern: "import.*createUserAction.*from.*@/lib/actions/admin-users"
    - from: "src/components/admin/users/UserCreateForm.tsx"
      to: "src/lib/validations/user-create.ts"
      via: "schema import for client validation"
      pattern: "import.*userCreateSchema.*from.*@/lib/validations/user-create"
---

<objective>
Create the user creation form and page for admin user management.

Purpose: Enable admins to create new users (trainees, coaches, admins) with proper form validation and feedback.

Output:
- User creation page at /admin/users/create
- UserCreateForm component with react-hook-form integration
</objective>

<execution_context>
@/Users/itayostraich/.claude/get-shit-done/workflows/execute-plan.md
@/Users/itayostraich/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-user-management/02-CONTEXT.md
@.planning/phases/02-user-management/02-RESEARCH.md
@.planning/phases/02-user-management/02-01-SUMMARY.md

Key existing files:
@src/components/admin/UserEditForm.tsx - pattern for admin forms with react-hook-form
@src/lib/actions/admin-users.ts - server actions from Plan 01
@src/lib/validations/user-create.ts - validation schema from Plan 01
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create UserCreateForm component</name>
  <files>src/components/admin/users/UserCreateForm.tsx</files>
  <action>
Create client component with "use client" directive. Follow existing UserEditForm patterns.

Form fields (per CONTEXT.md):
- full_name: Text input, required
- phone: Text input with dir="ltr", required, Israeli format
- role: Select dropdown (trainee/trainer/admin), required
- email: Text input, optional

Component structure:
```typescript
"use client";

import { useState } from "react";
import { useRouter } from "next/navigation";
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import { userCreateSchema, type CreateUserInput } from "@/lib/validations/user-create";
import { createUserAction } from "@/lib/actions/admin-users";
import { Form, FormControl, FormDescription, FormField, FormItem, FormLabel, FormMessage } from "@/components/ui/form";
import { Input } from "@/components/ui/input";
import { Button } from "@/components/ui/button";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { toast } from "sonner";
import { Loader2, UserPlus } from "lucide-react";

export function UserCreateForm() {
  const [loading, setLoading] = useState(false);
  const router = useRouter();

  const form = useForm<CreateUserInput>({
    resolver: zodResolver(userCreateSchema),
    defaultValues: {
      full_name: "",
      phone: "",
      role: "trainee",
      email: "",
    },
  });

  const onSubmit = async (data: CreateUserInput) => {
    setLoading(true);
    try {
      const result = await createUserAction(data);

      if (result.error) {
        if (result.fieldErrors) {
          // Set field-level errors
          Object.entries(result.fieldErrors).forEach(([field, errors]) => {
            form.setError(field as keyof CreateUserInput, {
              message: errors[0],
            });
          });
        }
        toast.error(result.error);
        return;
      }

      toast.success("המשתמש נוצר בהצלחה!");
      router.push("/admin/users");
      router.refresh();
    } catch (error) {
      toast.error("שגיאה ביצירת המשתמש");
    } finally {
      setLoading(false);
    }
  };

  // ... form JSX with all fields
}
```

UI requirements:
- Use shadcn/ui Form components
- Hebrew labels and error messages
- Loading state with Loader2 spinner
- Submit button disabled during loading
- Role descriptions in Hebrew (מתאמן, מאמן, מנהל)
  </action>
  <verify>
TypeScript compiles: `npx tsc --noEmit`
Component uses correct imports from Plan 01 files.
  </verify>
  <done>UserCreateForm component exists with all required fields and server action integration</done>
</task>

<task type="auto">
  <name>Task 2: Create user creation page</name>
  <files>src/app/admin/users/create/page.tsx</files>
  <action>
Create server component page at /admin/users/create.

Page requirements:
- Server component (no "use client")
- Verify admin role before rendering (same pattern as existing admin pages)
- Redirect non-admins to /dashboard
- Display page title and description
- Render UserCreateForm component
- Back button/link to /admin/users

Structure:
```typescript
import { redirect } from "next/navigation";
import Link from "next/link";
import { createClient } from "@/lib/supabase/server";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { ArrowRight, UserPlus } from "lucide-react";
import { UserCreateForm } from "@/components/admin/users/UserCreateForm";

export default async function AdminCreateUserPage() {
  const supabase = await createClient();

  // Verify admin role
  const { data: { user } } = await supabase.auth.getUser();
  if (!user) redirect("/login");

  const { data: profile } = await supabase
    .from("profiles")
    .select("role")
    .eq("id", user.id)
    .single();

  if (profile?.role !== "admin") redirect("/dashboard");

  return (
    <div className="space-y-6">
      {/* Back button */}
      <Button variant="ghost" asChild>
        <Link href="/admin/users">
          <ArrowRight className="h-4 w-4 ml-2" />
          חזרה לרשימת משתמשים
        </Link>
      </Button>

      {/* Page header */}
      <div>
        <h1 className="text-3xl font-bold mb-2">יצירת משתמש חדש</h1>
        <p className="text-muted-foreground">הוספת משתמש חדש למערכת</p>
      </div>

      {/* Form card */}
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <UserPlus className="h-5 w-5" />
            פרטי המשתמש
          </CardTitle>
          <CardDescription>הזן את פרטי המשתמש החדש</CardDescription>
        </CardHeader>
        <CardContent>
          <UserCreateForm />
        </CardContent>
      </Card>
    </div>
  );
}
```
  </action>
  <verify>
Page accessible at /admin/users/create when logged in as admin.
TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>User creation page exists at /admin/users/create with admin role verification</done>
</task>

</tasks>

<verification>
1. TypeScript passes: `npx tsc --noEmit`
2. Build passes: `npm run build`
3. Form component imports from Plan 01 files (actions, validations)
4. Page verifies admin role before rendering
5. Form shows loading state during submission
</verification>

<success_criteria>
- /admin/users/create page accessible to admins only
- Form collects name, phone, role, optional email
- Form validates input before submission
- Successful creation redirects to /admin/users with toast
- Validation errors show inline under fields
</success_criteria>

<output>
After completion, create `.planning/phases/02-user-management/02-02-SUMMARY.md`
</output>
