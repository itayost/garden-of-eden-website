---
phase: 10-trainee-images-fifa-cards
plan: 03
type: execute
wave: 2
depends_on: ["10-01"]
files_modified:
  - src/components/admin/users/TraineeImageUpload.tsx
autonomous: true

must_haves:
  truths:
    - "User can select an image file via file picker"
    - "Selected image shows as preview before upload"
    - "User can confirm or cancel before processing"
    - "Processing shows loading state"
    - "Processed cutout result shows before final save"
    - "User can reject cutout and try another photo"
  artifacts:
    - path: "src/components/admin/users/TraineeImageUpload.tsx"
      provides: "Multi-step trainee image upload component"
      exports: ["TraineeImageUpload"]
      min_lines: 150
  key_links:
    - from: "TraineeImageUpload.tsx"
      to: "/api/images/process-background"
      via: "fetch POST"
      pattern: "fetch.*api/images/process-background"
---

<objective>
Create the TraineeImageUpload component with the multi-step flow: select -> preview -> processing -> result. Implements all CONTEXT.md decisions about click-to-browse, preview before upload, cutout result preview, and "Try another photo" option.

Purpose: Admin/coach interface for uploading and approving trainee photos
Output: Complete upload component with 4-step flow
</objective>

<execution_context>
@/Users/itayostraich/.claude/get-shit-done/workflows/execute-plan.md
@/Users/itayostraich/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-trainee-images-fifa-cards/10-CONTEXT.md
@.planning/phases/10-trainee-images-fifa-cards/10-RESEARCH.md
@src/components/ui/image-upload.tsx
@src/components/ui/button.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TraineeImageUpload component</name>
  <files>src/components/admin/users/TraineeImageUpload.tsx</files>
  <action>
Create a new component for trainee image upload with multi-step flow:

**Component Interface:**
```typescript
interface TraineeImageUploadProps {
  traineeUserId: string;
  currentAvatarUrl?: string | null;
  onSuccess: (originalUrl: string, processedUrl: string) => void;
  onCancel?: () => void;
}
```

**State Management:**
```typescript
type UploadStep = 'select' | 'preview' | 'processing' | 'result';
const [step, setStep] = useState<UploadStep>('select');
const [selectedFile, setSelectedFile] = useState<File | null>(null);
const [previewUrl, setPreviewUrl] = useState<string | null>(null);
const [processedUrl, setProcessedUrl] = useState<string | null>(null);
const [originalUrl, setOriginalUrl] = useState<string | null>(null);
const [error, setError] = useState<string | null>(null);
```

**Step 1 - Select (click to browse per CONTEXT.md):**
- Simple file input with hidden input element
- Button styled trigger: "בחר תמונה" (Select Photo)
- Accept JPG/PNG only, max 5MB
- Show current avatar if exists (small, to the side)
- On file select: validate, create preview URL, move to 'preview' step

**Step 2 - Preview:**
- Show selected image preview (large, centered)
- Two buttons: "אשר והמשך" (Confirm & Continue) and "בטל" (Cancel)
- Confirm moves to 'processing' step and triggers API call
- Cancel resets to 'select' step

**Step 3 - Processing:**
- Show spinner/loading indicator
- Text: "מעבד תמונה..." (Processing image...)
- Call /api/images/process-background with FormData
- On success: store URLs, move to 'result' step
- On error: show error message, offer "נסה שוב" (Try again)

**Step 4 - Result:**
- Show processed cutout image (on neutral/checkered background to show transparency)
- Two buttons: "שמור" (Save) and "נסה תמונה אחרת" (Try another photo)
- Save calls onSuccess with both URLs
- "Try another" resets to 'select' step

**Styling:**
- Use existing UI components (Button, etc.)
- Centered layout for preview/result steps
- Hebrew text throughout (RTL)
- Use Tailwind for styling

**Error Handling:**
- File validation errors (type, size) shown inline
- API errors shown with retry option
- Clear errors when user takes action

**Cleanup:**
- Revoke object URLs on unmount and step changes
  </action>
  <verify>
TypeScript compiles:
`npx tsc --noEmit src/components/admin/users/TraineeImageUpload.tsx`
  </verify>
  <done>
TraineeImageUpload component created with 4-step flow: select, preview, processing, result. Implements all CONTEXT.md decisions.
  </done>
</task>

</tasks>

<verification>
1. Component file exists at src/components/admin/users/TraineeImageUpload.tsx
2. Component exports TraineeImageUpload
3. Has 4 distinct steps (select, preview, processing, result)
4. Uses fetch to call /api/images/process-background
5. TypeScript compiles without errors
6. Hebrew text for all UI elements
</verification>

<success_criteria>
- [ ] TraineeImageUpload component created
- [ ] Click-to-browse file selection (no drag-drop per CONTEXT.md)
- [ ] Preview step shows selected image with confirm/cancel
- [ ] Processing step shows loading state
- [ ] Result step shows cutout with Save/Try another options
- [ ] Hebrew text throughout
- [ ] TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/10-trainee-images-fifa-cards/10-03-SUMMARY.md`
</output>
