---
phase: 10-trainee-images-fifa-cards
plan: 04
type: execute
wave: 3
depends_on: ["10-02", "10-03"]
files_modified:
  - src/app/admin/users/[userId]/page.tsx
  - src/components/admin/users/TraineeImageSection.tsx
autonomous: true

must_haves:
  truths:
    - "Admin can access image upload from user edit page"
    - "Current trainee avatar displays in image section"
    - "Upload triggers TraineeImageUpload component"
    - "Successful upload updates avatar display immediately"
  artifacts:
    - path: "src/components/admin/users/TraineeImageSection.tsx"
      provides: "Section wrapper for image upload in user edit"
      exports: ["TraineeImageSection"]
    - path: "src/app/admin/users/[userId]/page.tsx"
      provides: "User edit page with image section"
      contains: "TraineeImageSection"
  key_links:
    - from: "TraineeImageSection.tsx"
      to: "TraineeImageUpload.tsx"
      via: "component import"
      pattern: "TraineeImageUpload"
    - from: "TraineeImageSection.tsx"
      to: "admin-images.ts"
      via: "server action"
      pattern: "updateTraineeAvatarUrls"
---

<objective>
Integrate trainee image upload into the admin user edit page. Create a section component that displays current avatar and provides upload functionality, then add it to the existing user edit page layout.

Purpose: Connect upload component to admin workflow
Output: Image section component, updated user edit page
</objective>

<execution_context>
@/Users/itayostraich/.claude/get-shit-done/workflows/execute-plan.md
@/Users/itayostraich/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-trainee-images-fifa-cards/10-CONTEXT.md
@.planning/phases/10-trainee-images-fifa-cards/10-02-SUMMARY.md
@.planning/phases/10-trainee-images-fifa-cards/10-03-SUMMARY.md
@src/app/admin/users/[userId]/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TraineeImageSection component</name>
  <files>src/components/admin/users/TraineeImageSection.tsx</files>
  <action>
Create a client component that wraps the image upload functionality:

**Component Interface:**
```typescript
interface TraineeImageSectionProps {
  traineeUserId: string;
  traineeName: string;
  currentAvatarUrl: string | null;
}
```

**State:**
```typescript
const [isUploadOpen, setIsUploadOpen] = useState(false);
const [avatarUrl, setAvatarUrl] = useState(currentAvatarUrl);
const [isUpdating, setIsUpdating] = useState(false);
```

**Layout:**
1. Card wrapper with header:
   - Title: "תמונת פרופיל" (Profile Photo)
   - Optional: Camera icon

2. Content section:
   - Display current avatar (or initials fallback):
     - Use @radix-ui/react-avatar component
     - Size: 96x96 (w-24 h-24)
     - Show trainee initials if no avatar
   - Button: "שנה תמונה" (Change Photo) or "הוסף תמונה" (Add Photo) if none
   - Small text hint about FIFA card cutout

3. Sheet for upload (slides from left for RTL):
   - Use Sheet component from shadcn/ui
   - Contains TraineeImageUpload component
   - Closes on success or cancel

**On Success Handler:**
- Call updateTraineeAvatarUrls server action
- Show loading state
- On success: update local avatarUrl state, close sheet, show toast
- On error: show error toast

**Toast Messages:**
- Success: "תמונת הפרופיל עודכנה בהצלחה" (Profile photo updated successfully)
- Error: "שגיאה בעדכון התמונה" (Error updating photo)

**Imports needed:**
- TraineeImageUpload from ./TraineeImageUpload
- updateTraineeAvatarUrls from @/lib/actions/admin-images
- Avatar from @radix-ui/react-avatar or shadcn Avatar
- Sheet, SheetContent, SheetHeader, SheetTitle from @/components/ui/sheet
- Button from @/components/ui/button
- Card, CardContent, CardHeader, CardTitle from @/components/ui/card
- toast from sonner
  </action>
  <verify>
TypeScript compiles:
`npx tsc --noEmit src/components/admin/users/TraineeImageSection.tsx`
  </verify>
  <done>
TraineeImageSection component created with avatar display, upload button, and Sheet-based upload flow.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add TraineeImageSection to user edit page</name>
  <files>src/app/admin/users/[userId]/page.tsx</files>
  <action>
Update the existing user edit page to include the image section:

1. Import TraineeImageSection:
   ```typescript
   import { TraineeImageSection } from "@/components/admin/users/TraineeImageSection";
   ```

2. Add to the sidebar column (right side on LTR, left on RTL):
   - Place ABOVE the "User Summary Card" in the sidebar
   - This makes it the first item in the sidebar

3. Pass required props:
   ```tsx
   <TraineeImageSection
     traineeUserId={userId}
     traineeName={userToEdit.full_name || "משתמש"}
     currentAvatarUrl={userToEdit.avatar_url}
   />
   ```

4. The existing layout structure is:
   ```tsx
   <div className="grid lg:grid-cols-3 gap-6">
     {/* Edit Form - lg:col-span-2 */}
     <div className="lg:col-span-2">...</div>

     {/* Sidebar */}
     <div className="space-y-6">
       {/* ADD TraineeImageSection HERE */}
       {/* User Summary Card */}
       {/* Activity Log */}
     </div>
   </div>
   ```

5. Note: Only show for trainee users (role check optional since admin can upload for anyone).
  </action>
  <verify>
Page still compiles and renders:
`npx tsc --noEmit src/app/admin/users/\\[userId\\]/page.tsx`
  </verify>
  <done>
User edit page updated with TraineeImageSection in the sidebar, above the user summary card.
  </done>
</task>

</tasks>

<verification>
1. TraineeImageSection.tsx exists and exports component
2. User edit page imports and renders TraineeImageSection
3. Both files compile without TypeScript errors
4. TraineeImageSection appears in sidebar layout
</verification>

<success_criteria>
- [ ] TraineeImageSection component created
- [ ] Shows current avatar or initials fallback
- [ ] Has "Change Photo" / "Add Photo" button
- [ ] Opens Sheet with TraineeImageUpload on click
- [ ] Calls updateTraineeAvatarUrls on successful upload
- [ ] Shows toast on success/error
- [ ] User edit page includes TraineeImageSection in sidebar
- [ ] TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/10-trainee-images-fifa-cards/10-04-SUMMARY.md`
</output>
