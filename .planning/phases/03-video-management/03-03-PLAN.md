---
phase: 03-video-management
plan: 03
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/components/admin/videos/VideoTableColumns.tsx
  - src/components/admin/videos/VideoTableToolbar.tsx
  - src/components/admin/videos/VideoTablePagination.tsx
  - src/components/admin/videos/VideoDataTable.tsx
autonomous: true

must_haves:
  truths:
    - "Video table displays thumbnails from YouTube"
    - "Table columns are sortable by day number and title"
    - "Pagination controls navigate through video list"
    - "Search filters videos by title"
  artifacts:
    - path: "src/components/admin/videos/VideoTableColumns.tsx"
      provides: "TanStack Table column definitions"
      min_lines: 50
    - path: "src/components/admin/videos/VideoDataTable.tsx"
      provides: "Main data table component"
      min_lines: 80
    - path: "src/components/admin/videos/VideoTableToolbar.tsx"
      provides: "Search and filter toolbar"
      min_lines: 40
    - path: "src/components/admin/videos/VideoTablePagination.tsx"
      provides: "Pagination controls"
      min_lines: 30
  key_links:
    - from: "src/components/admin/videos/VideoDataTable.tsx"
      to: "src/components/admin/videos/VideoTableColumns.tsx"
      via: "import columns"
      pattern: "import.*columns.*from"
    - from: "src/components/admin/videos/VideoTableColumns.tsx"
      to: "src/lib/utils/youtube.ts"
      via: "thumbnail generation"
      pattern: "getYouTube(Id|Thumbnail)"
---

<objective>
Create TanStack Table components for displaying and managing video list.

Purpose: Build the data table infrastructure for video management, enabling sorting, filtering, and pagination.
Output: Four components - column definitions, toolbar, pagination, and main table.
</objective>

<execution_context>
@/Users/itayostraich/.claude/get-shit-done/workflows/execute-plan.md
@/Users/itayostraich/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/03-video-management/03-CONTEXT.md
@.planning/phases/03-video-management/03-RESEARCH.md
@.planning/phases/03-video-management/03-01-SUMMARY.md

# Existing patterns to follow
@src/components/admin/users/UserTableColumns.tsx
@src/components/admin/users/UserDataTable.tsx
@src/components/admin/users/UserTableToolbar.tsx
@src/components/admin/users/UserTablePagination.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create VideoTableColumns</name>
  <files>src/components/admin/videos/VideoTableColumns.tsx</files>
  <action>
Create column definitions following UserTableColumns.tsx pattern.

Columns (in order):
1. **thumbnail** (id: "thumbnail")
   - No header text
   - Cell: img element with YouTube thumbnail
   - Use getYouTubeThumbnail(getYouTubeId(row.original.youtube_url), "mqdefault")
   - Styling: w-24 h-14 object-cover rounded
   - Handle null videoId gracefully (show placeholder or nothing)
   - enableSorting: false

2. **title** (accessorKey: "title")
   - Header: "כותרת" with sortable button (ArrowUpDown icon)
   - Cell: font-medium text

3. **day_number** (accessorKey: "day_number")
   - Header: "יום" with sortable button
   - Cell: Badge variant="outline" showing "יום {value}"

4. **day_topic** (accessorKey: "day_topic")
   - Header: "נושא"
   - Cell: plain text, truncate if needed
   - enableSorting: false

5. **duration_minutes** (accessorKey: "duration_minutes")
   - Header: "משך"
   - Cell: "{value} דקות" with Clock icon
   - enableSorting: false

6. **actions** (id: "actions")
   - Header: "" (empty)
   - Cell: placeholder for action buttons (edit/delete)
   - Pass row.original through to allow parent to render actions
   - enableSorting: false

Import getYouTubeId, getYouTubeThumbnail from @/lib/utils/youtube
Use WorkoutVideo type from @/types/database
  </action>
  <verify>TypeScript compiles without errors: `npx tsc --noEmit`</verify>
  <done>Column definitions export with thumbnail, sortable headers, and action slot</done>
</task>

<task type="auto">
  <name>Task 2: Create VideoTableToolbar</name>
  <files>src/components/admin/videos/VideoTableToolbar.tsx</files>
  <action>
Create toolbar following UserTableToolbar.tsx pattern.

Props:
```typescript
interface VideoTableToolbarProps {
  onSearchChange: (value: string) => void;
  onDayFilterChange: (value: number | null) => void;
}
```

Components:
1. **Search Input**
   - Placeholder: "חיפוש לפי כותרת..."
   - Search icon on right side (RTL)
   - Debounce search with 300ms delay (use-debounce)
   - Call onSearchChange with debounced value

2. **Day Filter Select**
   - Placeholder: "כל הימים"
   - Options: "יום 1" through "יום 5" + "כל הימים" (null value)
   - Call onDayFilterChange on change

Layout: flex gap-4 with search on right (start) and day filter on left
  </action>
  <verify>TypeScript compiles without errors: `npx tsc --noEmit`</verify>
  <done>Toolbar provides search and day filter with debounced input</done>
</task>

<task type="auto">
  <name>Task 3: Create VideoTablePagination</name>
  <files>src/components/admin/videos/VideoTablePagination.tsx</files>
  <action>
Create pagination following UserTablePagination.tsx pattern exactly.

Props:
```typescript
interface VideoTablePaginationProps {
  table: Table<WorkoutVideo>;
}
```

Display:
- "מציג {start}-{end} מתוך {total} סרטונים"
- Previous/Next buttons with chevron icons
- RTL icons: ChevronRight for previous, ChevronLeft for next
- Disable buttons appropriately (can't go before first or after last)

Use table.getCanPreviousPage(), table.getCanNextPage(), table.previousPage(), table.nextPage()
Calculate start/end from table state: pageIndex * pageSize + 1 to min((pageIndex + 1) * pageSize, totalRows)
  </action>
  <verify>TypeScript compiles without errors: `npx tsc --noEmit`</verify>
  <done>Pagination shows current range and navigation buttons</done>
</task>

<task type="auto">
  <name>Task 4: Create VideoDataTable</name>
  <files>src/components/admin/videos/VideoDataTable.tsx</files>
  <action>
Create main table component following UserDataTable.tsx pattern.

Props:
```typescript
interface VideoDataTableProps {
  data: WorkoutVideo[];
  renderActions?: (video: WorkoutVideo) => React.ReactNode;
}
```

Features:
1. **State management:**
   - sorting: SortingState with setSorting
   - globalFilter: string for search
   - dayFilter: number | null for day filter

2. **Filtered data (useMemo):**
   - Filter by globalFilter (match against title, case-insensitive)
   - Filter by dayFilter (exact match day_number)

3. **TanStack Table setup:**
   - Pass filteredData and columns
   - getCoreRowModel, getSortedRowModel, getPaginationRowModel
   - pageSize: 10

4. **Render structure:**
   - VideoTableToolbar at top
   - Table with headers and body
   - Empty state: "לא נמצאו סרטונים" centered
   - VideoTablePagination at bottom

5. **Row rendering:**
   - For actions column, call renderActions(row.original) if provided
   - No row click navigation (unlike users - videos don't have detail page)

Use flexRender for header and cell rendering.
Import columns from VideoTableColumns.
  </action>
  <verify>TypeScript compiles without errors: `npx tsc --noEmit`</verify>
  <done>VideoDataTable integrates all table components with filtering and sorting</done>
</task>

</tasks>

<verification>
1. All four components compile without TypeScript errors
2. Columns include thumbnail display using YouTube utilities
3. Table supports sorting and client-side filtering
4. Pagination shows correct counts and enables navigation
</verification>

<success_criteria>
- YouTube thumbnails display correctly in table
- Sorting by title and day_number works
- Search filters by video title
- Day filter restricts to specific day
- Pagination navigates through results
- Empty state shown when no videos match
</success_criteria>

<output>
After completion, create `.planning/phases/03-video-management/03-03-SUMMARY.md`
</output>
