---
phase: 05-auth-enhancements
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/auth/forgot-password/page.tsx
  - src/app/auth/reset-password/page.tsx
  - src/app/auth/login/page.tsx
  - src/lib/validations/auth.ts
autonomous: true

must_haves:
  truths:
    - "User can click 'Forgot Password' link on login page"
    - "User can enter email to request password reset"
    - "User arriving via reset link can set new password"
    - "Password requirements shown during reset"
  artifacts:
    - path: "src/app/auth/forgot-password/page.tsx"
      provides: "Password reset request form"
      min_lines: 60
    - path: "src/app/auth/reset-password/page.tsx"
      provides: "New password entry form"
      min_lines: 80
    - path: "src/lib/validations/auth.ts"
      provides: "Password validation schema"
      exports: ["passwordSchema"]
  key_links:
    - from: "src/app/auth/login/page.tsx"
      to: "/auth/forgot-password"
      via: "Link component"
      pattern: "href.*forgot-password"
    - from: "src/app/auth/forgot-password/page.tsx"
      to: "supabase.auth.resetPasswordForEmail"
      via: "Supabase client"
      pattern: "resetPasswordForEmail"
    - from: "src/app/auth/reset-password/page.tsx"
      to: "supabase.auth.updateUser"
      via: "Supabase client"
      pattern: "updateUser.*password"
---

<objective>
Implement password reset flow with forgot password and reset password pages.

Purpose: Allow users who have set a password to recover their account via email magic link. Since the app is currently OTP-only, this establishes the foundation for password-based auth alongside existing OTP.

Output: Two new auth pages (forgot-password, reset-password), password validation schema, and forgot password link on login page.
</objective>

<execution_context>
@/Users/itayostraich/.claude/get-shit-done/workflows/execute-plan.md
@/Users/itayostraich/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-auth-enhancements/05-RESEARCH.md

# Reference existing auth pages for patterns:
@src/app/auth/login/page.tsx
@src/app/auth/verify/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create password validation schema</name>
  <files>src/lib/validations/auth.ts</files>
  <action>
Create a new validation file for auth-related schemas.

Create `passwordSchema` with zod:
- Min 8 characters
- At least one uppercase letter
- At least one lowercase letter
- At least one number
- Descriptive Hebrew error messages for each requirement

Export a `passwordRequirements` array of objects with `{label: string, test: (value: string) => boolean}` for use in password strength UI.

Follow existing validation patterns from `src/lib/validations/` folder.
  </action>
  <verify>
File exists at src/lib/validations/auth.ts
Exports passwordSchema and passwordRequirements
TypeScript compiles without errors: `npx tsc --noEmit`
  </verify>
  <done>
passwordSchema validates passwords with Hebrew error messages
passwordRequirements array can be used for UI indicators
  </done>
</task>

<task type="auto">
  <name>Task 2: Create forgot password page</name>
  <files>src/app/auth/forgot-password/page.tsx</files>
  <action>
Create forgot-password page following existing auth page patterns (login/page.tsx).

Structure:
- "use client" directive
- Same card layout as login page (Card with CardHeader/CardContent)
- Email input field with dir="ltr"
- Submit button with loading state (Loader2 spinner)
- Success state showing "נשלח לך קישור לאיפוס סיסמה"
- Link back to login page

Functionality:
- Use `supabase.auth.resetPasswordForEmail(email, { redirectTo: '${origin}/auth/reset-password' })`
- Show toast on success/error (sonner)
- Handle loading state
- Show success message after submission (don't redirect, let user check email)

Hebrew copy:
- Title: "איפוס סיסמה"
- Description: "הזינו את כתובת האימייל שלכם ונשלח לכם קישור לאיפוס"
- Button: "שלח קישור איפוס"
- Success: "נשלח לך קישור לאיפוס סיסמה לכתובת האימייל"
- Back link: "חזרה להתחברות"
  </action>
  <verify>
Page renders at /auth/forgot-password
Form submits and shows loading state
Success message appears after submission
Back to login link works
  </verify>
  <done>
Forgot password page accepts email and calls Supabase resetPasswordForEmail
Success state clearly indicates email was sent
  </done>
</task>

<task type="auto">
  <name>Task 3: Create reset password page</name>
  <files>src/app/auth/reset-password/page.tsx</files>
  <action>
Create reset-password page for users arriving via email magic link.

When user clicks email link, Supabase authenticates them and redirects to this page with session.

Structure:
- "use client" directive
- Same card layout as other auth pages
- Password input with dir="ltr" and show/hide toggle
- Confirm password input
- Password requirements checklist (real-time validation using passwordRequirements)
- Submit button with loading state

Functionality:
- Import and use passwordSchema from auth.ts
- Use react-hook-form with zodResolver
- On submit: `supabase.auth.updateUser({ password: newPassword })`
- Redirect to /dashboard on success
- Show toast on success/error

Password strength indicator:
- Map over passwordRequirements
- Show green check or red X for each requirement
- Only enable submit when all requirements met

Hebrew copy:
- Title: "הגדרת סיסמה חדשה"
- Description: "בחרו סיסמה חדשה לחשבון שלכם"
- Password label: "סיסמה חדשה"
- Confirm label: "אימות סיסמה"
- Button: "עדכן סיסמה"
- Success toast: "הסיסמה עודכנה בהצלחה"
  </action>
  <verify>
Page renders at /auth/reset-password
Password requirements update in real-time as user types
Form validates both password strength and match
Successful submission redirects to dashboard
  </verify>
  <done>
Reset password page validates and updates password via Supabase
Password requirements shown as checklist with real-time feedback
  </done>
</task>

</tasks>

<verification>
1. Navigate to /auth/forgot-password - page loads
2. Enter email, submit - loading state, then success message
3. Navigate to /auth/reset-password directly - page loads (will need session from email link to actually reset)
4. Password requirements indicator works in real-time
5. TypeScript compiles: `npx tsc --noEmit`
</verification>

<success_criteria>
- Forgot password page sends reset email via Supabase
- Reset password page validates and updates password
- Password strength requirements shown with real-time feedback
- All pages follow existing auth page visual patterns
- Hebrew text throughout, LTR inputs
</success_criteria>

<output>
After completion, create `.planning/phases/05-auth-enhancements/05-01-SUMMARY.md`
</output>
