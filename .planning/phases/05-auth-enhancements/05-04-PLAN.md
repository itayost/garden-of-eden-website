---
phase: 05-auth-enhancements
plan: 04
type: execute
wave: 2
depends_on: ["05-02"]
files_modified:
  - src/app/dashboard/settings/security/page.tsx
  - src/app/dashboard/settings/layout.tsx
  - src/components/dashboard/Sidebar.tsx
autonomous: true

must_haves:
  truths:
    - "User can navigate to security settings from dashboard"
    - "Security page shows current 2FA status"
    - "User can enable 2FA from security settings"
    - "User can disable 2FA from security settings"
  artifacts:
    - path: "src/app/dashboard/settings/security/page.tsx"
      provides: "Security settings page with 2FA management"
      min_lines: 80
    - path: "src/app/dashboard/settings/layout.tsx"
      provides: "Settings page layout"
      min_lines: 20
  key_links:
    - from: "src/app/dashboard/settings/security/page.tsx"
      to: "src/hooks/use-mfa.ts"
      via: "useMFA hook import"
      pattern: "import.*useMFA"
    - from: "src/app/dashboard/settings/security/page.tsx"
      to: "src/components/auth/TwoFactorSetup.tsx"
      via: "Component import"
      pattern: "import.*TwoFactorSetup"
---

<objective>
Create security settings page with 2FA management.

Purpose: Provide users a dedicated place to manage their account security, including enabling/disabling 2FA. This is the main entry point for 2FA enrollment.

Output: Security settings page at /dashboard/settings/security with 2FA toggle and setup flow.
</objective>

<execution_context>
@/Users/itayostraich/.claude/get-shit-done/workflows/execute-plan.md
@/Users/itayostraich/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-auth-enhancements/05-RESEARCH.md

# Reference MFA helpers:
@src/hooks/use-mfa.ts
@src/components/auth/TwoFactorSetup.tsx
@src/components/auth/TwoFactorDisable.tsx

# Reference existing dashboard patterns:
@src/app/dashboard/page.tsx
@src/components/dashboard/Sidebar.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create settings layout</name>
  <files>src/app/dashboard/settings/layout.tsx</files>
  <action>
Create settings section layout.

Simple layout that:
- Wraps children in settings container
- Could add settings navigation tabs later (security, profile, etc.)
- For now, just pass through children with consistent padding

Structure:
```typescript
export default function SettingsLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <div className="space-y-6">
      <div>
        <h1 className="text-2xl font-bold">הגדרות</h1>
        <p className="text-muted-foreground">נהלו את החשבון והאבטחה שלכם</p>
      </div>
      {children}
    </div>
  )
}
```

Keep it minimal - can expand later if needed.
  </action>
  <verify>
Layout file exists
Layout renders children
TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>
Settings layout provides consistent wrapper for settings pages
  </done>
</task>

<task type="auto">
  <name>Task 2: Create security settings page</name>
  <files>src/app/dashboard/settings/security/page.tsx</files>
  <action>
Create security settings page with 2FA management.

Page is "use client" to use useMFA hook.

Structure:
1. **2FA Section Card**:
   - Title: "אימות דו-שלבי (2FA)"
   - Description explaining what 2FA is
   - Status badge: "מופעל" (green) or "לא מופעל" (gray)
   - Action button: "הפעל" or "בטל" based on status

2. **2FA Flow**:
   - If not enabled: Show enable button
   - When enable clicked: Open Sheet/Dialog with TwoFactorSetup component
   - If enabled: Show enrolled date, disable button
   - When disable clicked: Open TwoFactorDisable dialog

Implementation:
- Use useMFA hook to get hasMFA, factors, isLoading
- useState for showSetup (controls TwoFactorSetup visibility)
- useState for showDisable (controls TwoFactorDisable visibility)
- Use Sheet component for setup flow (slides from side - established pattern from 03-04)
- Use AlertDialog for disable (destructive action pattern)

Security info section (static):
- Card with security tips
- "עצות אבטחה" heading
- Tips like: use strong passwords, don't share login, enable 2FA

Hebrew copy:
- Page title (from layout): "הגדרות"
- Section: "אימות דו-שלבי (2FA)"
- Description: "הגנו על החשבון שלכם עם שכבת אבטחה נוספת"
- Enabled status: "מופעל"
- Disabled status: "לא מופעל"
- Enable button: "הפעל 2FA"
- Enrolled since: "הופעל ב-{date}"
  </action>
  <verify>
Page renders at /dashboard/settings/security
Shows correct 2FA status (enabled/disabled)
Enable button opens TwoFactorSetup
Disable button opens TwoFactorDisable dialog
TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>
Security settings page displays 2FA status
Users can enable/disable 2FA from this page
UI follows established patterns (Sheet for forms, AlertDialog for destructive)
  </done>
</task>

<task type="auto">
  <name>Task 3: Add settings link to sidebar</name>
  <files>src/components/dashboard/Sidebar.tsx</files>
  <action>
Add settings/security link to dashboard sidebar.

Find the sidebar navigation items and add:
- Icon: Settings or Shield from lucide-react
- Label: "הגדרות" or "אבטחה"
- Link: /dashboard/settings/security

Place near the bottom of nav items (before logout if exists).

Follow existing nav item pattern in the file - likely uses an array of objects with icon, label, href.

If sidebar doesn't have a clear nav items array, add a single Link/NavLink component following existing patterns in the file.
  </action>
  <verify>
Settings link appears in sidebar
Link navigates to /dashboard/settings/security
Icon displays correctly
TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>
Users can navigate to security settings from dashboard sidebar
  </done>
</task>

</tasks>

<verification>
1. Navigate to /dashboard/settings/security - page loads
2. 2FA status shows correctly (disabled for users without 2FA)
3. Enable button opens setup flow
4. Settings link visible in sidebar
5. TypeScript compiles: `npx tsc --noEmit`
</verification>

<success_criteria>
- Security settings page accessible from dashboard
- 2FA status clearly displayed
- Enable/disable flows work with appropriate components
- Follows established UI patterns (Sheet, AlertDialog)
- Hebrew text throughout
</success_criteria>

<output>
After completion, create `.planning/phases/05-auth-enhancements/05-04-SUMMARY.md`
</output>
